

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>march_hardware_interface &mdash; Project March Melodic documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'Melodic',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="march_imu_manager" href="march_imu_manager.html" />
    <link rel="prev" title="march_hardware_builder" href="march_hardware_builder.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/create_your_workspace.html">Create your workspace</a></li>
</ul>
<p class="caption"><span class="caption-text">Useful tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/robot_model.html">Robot model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_control.html">ros_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/rqt.html">RQT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/ros_bag.html">ROS bag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/gazebo.html">Gazebo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/smach.html">SMACH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools/event_stream_processing.html">Event stream Processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Using the March Exoskeleton</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/high_level_overview.html">High level overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/connecting_to_the_exoskeleton.html">Connecting to the exoskeleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_airgait.html">How to airgait</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/how_to_view_live_data.html">How to view live data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/log_files.html">Log files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_gait_generator.html">Using the gait generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/error_codes.html">Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_the_march_exoskeleton/using_the_pressure_soles.html">Using the pressure soles</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../continuous_integration/continuous_integration.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/style_guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/add_a_new_gait.html">Add a new gait</a></li>
</ul>
<p class="caption"><span class="caption-text">March Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="march_data_collector.html">march_data_collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_description.html">march_description</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_fake_sensor_data.html">march_fake_sensor_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gain_scheduling.html">march_gain_scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gait_files.html">march_gait_files</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware.html">march_hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_hardware_builder.html">march_hardware_builder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">march_hardware_interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#controllers">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#safety-limits">Safety Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-controller-interfaces">Custom Controller Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ros-api">ROS API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nodes">Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#published-topics">Published Topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="march_imu_manager.html">march_imu_manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_input_device.html">march_input_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_launch.html">march_launch</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_rqt_input_device.html">march_rqt_input_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_rqt_software_check.html">march_rqt_software_check</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_safety.html">march_safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_classes.html">march_shared_classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_shared_resources.html">march_shared_resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_state_machine.html">march_state_machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_gait_selection.html">march_gait_selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="march_simulation.html">march_simulation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Project March</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>march_hardware_interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/project-march/tutorials/blob/master/doc/march_packages/march_hardware_interface.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="march-hardware-interface">
<span id="march-hardware-interface-label"></span><h1>march_hardware_interface<a class="headerlink" href="#march-hardware-interface" title="Permalink to this headline">¶</a></h1>
<p>The march_hardware_interface package uses the march_hardware (see
<a class="reference internal" href="march_hardware.html#march-hardware-label"><span class="std std-ref">march_hardware</span></a>) library to create an interface between ros_control
and the exoskeleton hardware. It has one runnable node which functions as the
control loop. The loop consists of the following steps:</p>
<ol class="arabic simple">
<li>Reading data from the robot</li>
<li>Updating the connected controllers using the read data</li>
<li>Writing the output of the controllers to the robot</li>
</ol>
<p>The class that is responsible for all this is the <code class="docutils literal"><span class="pre">MarchHardwareInterface</span></code>.
It implements the <code class="docutils literal"><span class="pre">hardware_interface::RobotHW</span></code> class from <a class="reference external" href="https://wiki.ros.org/ros_control">ros_control</a>.
It implements three important functions from that base class: <code class="docutils literal"><span class="pre">init</span></code>, <code class="docutils literal"><span class="pre">read</span></code>
and <code class="docutils literal"><span class="pre">write</span></code>. Furthermore, the class owns an instance of the <code class="docutils literal"><span class="pre">MarchRobot</span></code>
class, which it uses for reading from and writing to the robot. The reading
and writing must happen in real time to ensure it runs deterministically and,
therefore, run at high frequencies. To guarantee this, real time publishers are
used from <a class="reference external" href="https://wiki.ros.org/realtime_tools">realtime_tools</a> and messages from ROS are published and received in
a <code class="docutils literal"><span class="pre">ros::AsyncSpinner</span></code>. Furthermore, all dynamically allocated resources, such
as <code class="docutils literal"><span class="pre">std::vector</span></code>, reserve their memory in the <code class="docutils literal"><span class="pre">init</span></code> function to guarantee
no allocations take place during real time.</p>
<div class="section" id="controllers">
<h2>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h2>
<p>Currently, the hardware interface can use two types of controllers: position
and effort controllers. Effort control is currently the default. The
march_hardware_interface package is also responsible for launching the
controllers and providing their configurations. These configurations are stored
in the <a class="reference external" href="https://github.com/project-march/hardware-interface/tree/develop/march_hardware_interface/config">config</a> directory.
These contain settings for the PID controllers and the joint trajectory action
server. See the <a class="reference external" href="https://wiki.ros.org/ros_control#Controllers">Controllers</a> section on the ros_control wiki for more info on
what type of controllers exists and how to configure them.</p>
</div>
<div class="section" id="safety-limits">
<h2>Safety Limits<a class="headerlink" href="#safety-limits" title="Permalink to this headline">¶</a></h2>
<p>Besides controlling the motors, the hardware interface also enforces safety
limits. For this it uses the <code class="docutils literal"><span class="pre">joint_limits_interface</span></code> from ros_control. The
robot has so called <em>soft limits</em>, which provide a buffer for the actual
mechanical limits of the joints. The soft limit values are loaded from the URDF.
The job of the limits interface is to limit the output of the controllers as to
not exceed the joint limits defined in the URDF. Enforcing the limits occurs at
the start of the <code class="docutils literal"><span class="pre">write</span></code> function, before writing the actuate commands to the
robot.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the <a class="reference external" href="https://wiki.ros.org/ros_control#Joint_Limits">Joint Limits</a> section on the ros_control wiki for more info on
the joint limits. Also see <a class="reference external" href="https://wiki.ros.org/pr2_controller_manager/safety_limits">Joint Safety Limits Explained</a> for more info on
how the limits work.</p>
</div>
</div>
<div class="section" id="custom-controller-interfaces">
<h2>Custom Controller Interfaces<a class="headerlink" href="#custom-controller-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The march_hardware_interface package also includes two custom controller
interfaces, specifically designed for the March exoskeleton. These include the
<code class="docutils literal"><span class="pre">MarchPdbStateInterface</span></code> and the <code class="docutils literal"><span class="pre">MarchTemperatureSensorInterface</span></code>. the
<code class="docutils literal"><span class="pre">MarchPdbStateInterface</span></code> is an interface for the <code class="docutils literal"><span class="pre">MarchPdbStateController</span></code>
, which is responsible for publishing the state of the power distribution board.
The <code class="docutils literal"><span class="pre">MarchTemperatureSensorInterface</span></code> is an interface for the
<code class="docutils literal"><span class="pre">MarchTemperatureSensorController</span></code>, which is responsible for publishing the
state of the temperature sensors in the joints.</p>
<div class="section" id="ros-api">
<h3>ROS API<a class="headerlink" href="#ros-api" title="Permalink to this headline">¶</a></h3>
<p>Since the hardware interface uses the controller_manager from ros_control, it
has many topics that enable the user to send trajectory commands and read the
state of loaded joints.</p>
</div>
</div>
<div class="section" id="nodes">
<h2>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>march_hardware_interface_node</dt>
<dd><p class="first">Builds an instance of <code class="docutils literal"><span class="pre">MarchRobot</span></code> from a given robot name and starts the
control loop. The node must be run with an argument of which robot to build
and use. For example, to run it without roslaunch/rosrun (This will only work
if you have a <code class="docutils literal"><span class="pre">roscore</span></code> running):</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">march_hardware_interface_node</span> <span class="n">march4</span>
</pre></div>
</div>
<p class="last">The <a class="reference external" href="https://github.com/project-march/hardware-interface/tree/develop/march_hardware_interface/launch/hardware.launch">hardware.launch</a>
file has a launch argument, which it passes to the node.</p>
</dd>
</dl>
</div>
<div class="section" id="published-topics">
<h2>Published Topics<a class="headerlink" href="#published-topics" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><em>/march/imc_states</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/ImcState.msg">march_shared_resources/ImcState</a>)</dt>
<dd>Publishes statuses of all iMotionCubes every control loop.</dd>
<dt><em>/march/controller/after_limit_joint_command</em> (<a class="reference external" href="https://github.com/project-march/march/tree/develop/march_shared_resources/msg/AfterLimitJointCommand.msg">march_shared_resources/AfterLimitJointCommand</a>)</dt>
<dd>Publishes joint commands after they have been limited by the joint safety
limit controller.</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="march_imu_manager.html" class="btn btn-neutral float-right" title="march_imu_manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="march_hardware_builder.html" class="btn btn-neutral float-left" title="march_hardware_builder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Project March
      <span class="lastupdated">
        Last updated on Jun 05, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>